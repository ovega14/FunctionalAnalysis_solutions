\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[]{amsthm} %lets us use \begin{proof}
\usepackage[]{amssymb} %gives us the character \varnothing
\usepackage[]{amsmath}
\usepackage[parfill]{parskip} %avoid indent when skipping lines
\usepackage[toc,page]{appendix}
\usepackage{mathtools}
\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,      
	urlcolor=cyan,
	pdftitle={18.102-ps6},
	pdfpagemode=FullScreen,
}
%\urlstyle{same}
\newcommand{\R}{\mathbb{R}} %the real numbers
\newcommand{\N}{\mathbb{N}} %the natural numbers
\newcommand{\M}{\mathcal{M}} %set of all Lebesgue-measurable sets
\newcommand{\Q}{\mathbb{Q}} % the rational numbers

\title{18.102 Assignment 6}
\author{Octavio Vega}
\date\today

\begin{document}
\maketitle
	
\section*{Problem 1}
\subsection*{(a)}
\begin{proof}
	Let $\epsilon > 0$, and define $c_1 := a$ and $c_{n+1} := b$. 
	
	Since $\psi$ is a step function on $[a, b]$, $\exists c_1 \leq c_2 \leq \cdots \leq c_n \leq c_{n+1} \in [a, b]$ such that $\forall i = 1, \cdots, n$,
	\begin{equation}\label{psi_inverse}
		\psi^{-1}(\{a_i\}) = (c_i, c_{i+1}],
	\end{equation}
	where each $a_i$ is one of the finitely many values that $\psi$ takes on. 
	
	Choose $\delta > 0$ such that $\delta < \frac{\epsilon}{2n}$. Define $g: [a, b] \rightarrow \R$ via
	\begin{align}
		g(x) := \begin{cases}
			\frac{a_i + a_{i-1}}{2} + \left(\frac{a_i - a_{i-1}}{2\delta}\right)(x-c_i), \; &x \in (c_i - \delta, c_i + \delta) \\
			a_i, \; &x \in [c_i + \delta, c_{i+1}-\delta] \\
			-\frac{a_n}{2\delta}(x-b), \; &x \in (c_{n-1}-\delta, b],
		\end{cases}
	\end{align}
	where $a_0 := -a_1$. Then
	\begin{equation}
		g(a) = \frac{a_1 + a_0}{2} + \left(\frac{a_1 - a_0}{2\delta}\right)(c_1 - c_1) = \frac{a_1 - a_1}{2} = 0,
	\end{equation}
	and
	\begin{equation}
		g(b) = -\frac{a_n}{2\delta}(b-b) = 0,
	\end{equation}
	as desired. We also see that since $g$ is piecewise linear, it is continuous. 
	
	Now consider the difference $|\psi(x) - g(x)|$.
	
	\underline{Case 1}: $x \in [c_i + \delta, c_{i+1} - \delta]$. Then by \eqref{psi_inverse}, we have
	\begin{equation}
		|\psi(x) - g(x)| = |\psi\left((c_i, c_{i+1}-\delta)\right) - a_i| = |a_i - a_i| = 0.
	\end{equation}
	\underline{Case 2}: $x \in (c_i - \delta, c_i + \delta)$. Then
	\begin{align}
		|\psi(x) - g(x)| &= \left|\frac{a_i + a_{i-1}}{2} + \left(\frac{a_i - a_{i-1}}{2\delta}\right)(x-c_i) - \psi(x)\right| \\
		&< \left|\frac{a_i + a_{i-1}}{2} + \left(\frac{a_i - a_{i-1}}{2\delta}\right)\delta - \psi(x)\right| \\
		&= \left|\frac{a_i + a_{i-1}}{2} + \frac{a_i + a_{i-1}}{2} - \psi(x)\right| \\
		&= |a_i - \psi(x)| \\
		&= 0 \textrm{ or } |a_{i+1} - a_i|.
	\end{align}
	\underline{Case 3}: $x \in (c_n - \delta, b)$. Then
	\begin{align}
		|\psi(x) - g(x)| &= \left|-\frac{a_n}{2\delta}(x-b) - \psi(x)\right| \\
		&< \left|-\frac{a_n}{2\delta}\delta - \psi(x)\right| \\
		&= \left|-\frac{a_n}{2} - \psi(x)\right| \\
		&= \frac{3a_n}{2}.
	\end{align}
	So in all three cases, we have that either $|g(x) - \psi(x)| = 0$, or $|g(x) - \psi(x)| < \frac{3a}{2}$, or $|g(x) - \psi(x)|< |a_{i+1} - a_i|$.
	
	Define the set $E$ to be the collection of points in $[a, b]$ for which $|\psi(x) - g(x)| \neq 0$. Then
	\begin{equation}
		E := \bigcup_{k=1}^{n} (c_k - \delta, c_k + \delta).
	\end{equation}
	By definition, $\forall x \in E^c$, 
	\begin{equation}
		|\psi(x) - g(x)| = 0 < \epsilon.
	\end{equation}
	Since $E$ is a countable union of intervals, we have
	\begin{align}
		m(E) &= m\left[\bigcup_{k=1}^n (c_k - \delta, c_k + \delta)\right] \\
		&\leq \sum_{k=1}^n m\left[(c_k - \delta, c_k + \delta)\right] \\
		&= \sum_{k=1}^n \ell (c_k - \delta, c_k + \delta) \\
		&= \sum_{k=1}^n 2\delta\\
		&= 2n\delta \\
		& < 2n \frac{\epsilon}{2n} \\
		&= \epsilon,
	\end{align}
	as desired.
\end{proof}

\subsection*{(b)}
\begin{proof}
	Suppose $E$ is Lebesgue measurable and $m(E) < \infty$. Then by Littlewood's first principle, $\forall \delta > 0$ $\exists$ a finite collection of open intervals $\{U_i\}_{i=1}^n$ such that
	\begin{equation}
		m\left(E \Delta \bigcup_{i=1}^n U_i\right) < \delta.
	\end{equation}
	Let $\epsilon > 0$. Since $\varphi$ is a simple function, then we can express it as
	\begin{equation}
		\varphi = \sum_{i=1}^n a_i \chi_{E_i},
	\end{equation}
	where we take $U_i$ such that the symmetric difference
	\begin{equation}
		m(U_i \backslash E_i) + m(E_i \backslash U_i) < \frac{\epsilon}{n}
	\end{equation}
	for each $i \in \{1, ..., n\}$. 
	
	Let $\psi = \sum_{i=1}^n a_i \chi_{U_i}$. Then $\forall x \in U \cap E = (U \Delta E)^c$,
	\begin{equation}
		|\varphi(x) - \psi(x)| = 0 < \epsilon.
	\end{equation}
	We have
	\begin{align}
		m(U \Delta E) &= \sum_{i=1}^n m(U_i \backslash E_i) + \sum_{i=1}^n m(E_i \backslash U_i) \\
		&< n \frac{\epsilon}{n} = \epsilon,
	\end{align}
	as desired.
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Problem 2}
\begin{proof}
	Let $c_0=a$, $c_n=b$, and partition $[a, b]$ into disjoint intervals as follows:
	\begin{equation}
		[a, b] = [c_0, c_1) \cup [c_1, c_2) \cup ... \cup [c_{n-1}, c_n) \cup \{b\}.
	\end{equation}
	Letting $U_k = [c_{k-1}, c_k)$ for each $k \in \{1, ... n\}$, we have
	\begin{equation}
		\bigcup_{k=1}^n U_k = [a, b).
	\end{equation}
	On each interval $U_k$, extract a closed set $F_k$ such that $f$ is continuous on $F_k$ and such that
	\begin{equation}
		m\left(\bigcup_{k=1}^n F_k^c\right) < \epsilon.
	\end{equation}
	Then for each $k \in \{1, ..., n\}$, $\exists F_k \subseteq U_k$ closed such that $m(E \backslash F_k) < \frac{\epsilon}{2^n}$ and such that $f\big|_{F_k}$ is continuous.
	
	Since $F_k$ is closed, then $F_k^c$ is open, so the union $\bigcup_{k=1}^n F_k^c$ is open as well. Then $E = \bigcup_{k=1}^n F_k^c$ can be expressed as a union of disjoint intervals:
	\begin{equation}
		E = \bigcup_{k=1}^n (a_k, b_k).
	\end{equation}
	Define $g: [a, b] \to \R$ via
	\begin{align}
		g(x) := \begin{cases}
			\frac{x - a_k}{b_k - a_k}f(b_k) + f(a_k), \quad &x \in E \\
			f(x), \quad &x \in E^c.
		\end{cases}
	\end{align}
	Then
	\begin{equation}
		\sup_{x \in [a, b]}|g(x)| \leq \sup_{x \in E}|g(x)| \leq |f(a_k)| + |f(b_k)|,
	\end{equation}
	and
	\begin{equation}
		\sup_{x \in [a, b]}|g(x)| \leq \sup_{x \in E^c}|g(x)| \leq \sup_{x \in E^c}|f(x)| \leq B.
	\end{equation}
	Also, 
	\begin{equation}
		m(E) = \sum_{k=1}^n m(F_k^c) < \sum_{k=1}^n \frac{\epsilon}{2^n} = \epsilon.
	\end{equation}
	Finally, $\forall x \in E^c$, $g(x) = f(x)$, so $|f(x) - g(x)| = 0 < \epsilon$.
	
	Therefore, the function $g$ meets the desired requirements.
\end{proof}

\end{document}
